@model OneDriveDataRobot.Models.HomeModel
@{
    ViewBag.Title = "Home Page";
}

<div class="jumbotron">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <h1>OneDrive Data Robot</h1>
                <p class="lead">Sample code project using Microsoft Graph</p>
            </div>
            <div class="col-md-1">&nbsp;</div>
            <div class="col-md-3">
                <img src="https://onedriveapi.azurewebsites.net/images/Robots_V3-02.svg" height="200" />
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <h2>Getting started</h2>
        <p>
            This sample code project provides an example of using Azure Functions to respond to webhook notifications generated by OneDrive users.
            The data robot can monitor changes to files, and respond in near real-time based to in context requests for more information inside an Excel co-authoring session.
            For more information, see the sample code source: <a href="https://github.com/onedrive/onedrive-data-robot-azure-function">onedrive-data-robot-azure-function</a>.
        </p>
    </div>
    <div class="col-md-6">
        @if (!string.IsNullOrEmpty(Model.SignInName))
        {
            <h2>Signed In</h2>
            <p>Hello @Model.DisplayName! I'm the OneDrive data robot.</p>
            <p id="results"></p>
            <p><a class="btn btn-default" id="btnActivate" href="#" onclick="activateRobot();">Activate</a>
            <a class="btn btn-default" id="btnDeactivate" href="#" onclick="disableRobot();">Disable</a></p>
        }
        else
        {
            <h2>Sign-In</h2>
            <p>@Html.ActionLink("Sign in", "SignIn", "Account") to get started.</p>
        }
    </div>
</div>

<script>
    function activateRobot() {
        var url = "/api/Setup/ActivateRobot";
        $("#results").text("Activating robot... hold on.");

        $.ajax({
            method: "POST",
            url: url,
            success: function (data, status, xhr) {
                if (!data.Success) {
                    $("#results").text("Error activating robot: " + data.Error);
                } else {
                    $("#results").html("<b>Robot activated!</b><br />Subscription Id: " + data.SubscriptionId + "<br />Expiration: " + data.ExpirationDateTime);
                }
            },
            error: function (xhr, status, errorThrown) {
                $("#results").text("Error activating robot: " + errorThrown);
            }
        });
    }
    function disableRobot() {
        var url = "/api/Setup/DisableRobot";
        $("#results").text("Disabling robot... hold on.");

        $.ajax({
            method: "POST",
            url: url,
            success: function (data, status, xhr) {
                if (!data.Success) {
                    $("#results").text("Error disabling robot: " + data.Error);
                } else {
                    $("#results").html("<b>Robot disabled</b> " + data.Error);
                }
            },
            error: function (xhr, status, errorThrown) {
                $("#results").text("Error disabling robot: " + errorThrown);
            }
        });
    }
</script>
